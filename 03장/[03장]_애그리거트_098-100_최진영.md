# 3.1 애그리거트

![3-1.png](image%2F3-1.png)

온라인 쇼핑몰 시스템을 개발할 때, 위 그림과 같이 상위 수준 개념을 이용해서 전체 모델을 정리하면 전반적인 관계를 이해하는데 도움이 됩니다.
> e.g) 주문은 회원, 상품, 결제와 관련이 있다는 것을 쉽게 파악 가능하다.

위의 상위 수준 모델들을 `개별 객체 단위`로 다시 그려보면 아래와 같습니다.

![3-2.png](image%2F3-2.png)

맨 처음 보았던 그림 같이 상위 모델에 대한 이해 없이 개별 객체 단위로만 상위 수준의 개념을 파악하려면 더 오랜 시간이 걸리게 되고, 결국에는 더 많은 코드를 보고 도메인
전문가와 더 많은 대화를 나눠야 비로소 상위 수준에서 모델 간의 관계가 이해되기 시작합니다.

100개 이상의 테이블을 한 장의 `ERD`에 모두 표시하면 개별 테이블 간의 관계를 파악하느라 큰 틀에서 데이터 구조를 이해하는 데 어려움을 겪게 되는 것처럼, 도메인 객체
모델이 복잡해지면 전반적인 구조나 큰 수준에서 `도메인 간의 관계를 파악하기 어려워집니다.`

`주요 도메인 요소 간의 관계를 파악하기 어렵다`는 것은 코드를 변경/확장하는 것이 어려워진다는 것을 의미합니다.

우리는 `상위 수준에서 모델이 어떻게 엮여 있는지` 알아야 `전체 모델을 망가뜨리지 않으면서` 추가 `요구사항을 모델에 반영`할 수 있는데,
세부적인 모델만 이해한 상태로는 코드를 수정하는 것이 꺼려지기 때문에 코드 변경을 최대한 회피하는 쪽으로 요구사항을 협의하게 됩니다.

꼼수를 부려 `당장 돌아가는 코드`를 추가활 수는 있지만 이런 방법은 장기적으로 코드를 더 수정하기 어렵게 만듭니다.
> 결론: 상위 수준에서 모델 간의 관계를 이해해야 코드의 변경/확장에서 자유로워진다.

---

### 애그리거트

복잡한 도메인을 이해하고 관리하기 쉬운 단위로 만들려면, `상위 수준에서 모델을 조망할 수 있는 방법`이 필요한데, 그 방법이 바로 **애그리거트**입니다.

앞장(2장)에서의 설명처럼 애그리거트는 관련된 객체를 `하나의 군`으로 묶어줍니다.

**수많은 객체를 애그리거트로 묶어서 바라보면 상위 수준에서 도메인 모델 간의 관계를 파악할 수 있습니다.**

![3-3.png](image%2F3-3.png)

위 그림은 앞선 그림을 애그리거트 단위로 묶어서 다시 표현한 것입니다. 동일한 모델이지만 애그리거트를 사용함으로써 모델 간의 관계를 `개별 모델 수준`과 `상위 수준`에서 모두
이해할 수 있게됩니다.

또한, 애그리거트는 모델을 이해하는 데 도움을 줄 뿐만 아니라 `일관성을 관리하는 기준`도 됩니다. 모델을 보다 잘 이해할 수 있고 애그리거트 단위로 일관성을 관리하기 때문에,
애그리거트는 복잡한 도메인을 단순한 구조로 만들어줍니다.

이렇게 복잡도가 낮아지는 만큼 도메인 기능을 확장하고 변경하는 데 필요한 노력(개발 시간)도 줄어들게 됩니다.

