# μ¤ν”„λ§ λ°μ΄ν„° JPAλ¥Ό μ΄μ©ν• μ΅°ν κΈ°λ¥

## 5.4 λ¦¬ν¬μ§€ν„°λ¦¬/DAOμ—μ„ μ¤ν© μ‚¬μ©ν•κΈ° 
> μ¤ν™: μ• κ·Έλ¦¬κ±°νΈκ°€ νΉμ • μ΅°κ±΄μ„ μ¶©μ΅±ν•λ”μ§€λ¥Ό κ²€μ‚¬ν•  λ• μ‚¬μ©ν•λ” μΈν„°νμ΄μ¤

μ¤ν™μ„ μ¶©μ΅±ν•λ” μ—”ν‹°ν‹°λ¥Ό κ²€μƒ‰ν•κ³  μ‹¶λ‹¤λ©΄ `findAll()` λ©”μ„λ“λ¥Ό μ‚¬μ©ν•λ©΄ λ©λ‹λ‹¤.
```java
public interface OrderSummaryDao extends Repository<OrderSummary, String> {
  
  List<OrderSummary> findAll(Specification<OrderSummary> spec);
}
```

`findAll()` λ©”μ„λ“λ” OrderSummaryμ— λ€ν• κ²€μƒ‰ μ΅°κ±΄μ„ ν‘ν„ν•λ” μ¤ν™ μΈν„°νμ΄μ¤λ¥Ό νλΌλ―Έν„°λ΅ κ°–μµλ‹λ‹¤.

μ„ λ©”μ„λ“μ™€, μ•μ„ μ‘μ„±ν• μ¤ν™ κµ¬ν„μ²΄λ¥Ό μ‚¬μ©ν•λ©΄ νΉμ • μ΅°κ±΄μ„ μ¶©μ΅±ν•λ” μ—”ν‹°ν‹°λ¥Ό κ²€μƒ‰ν•  μ μμµλ‹λ‹¤.
```java
// μ¤ν™ κ°μ²΄λ¥Ό μƒμ„±ν•κ³ 
Specification<OrderSummary> spec = new OrdererIdSpec("user1");

// findAll() λ©”μ„λ“λ¥Ό μ΄μ©ν•΄μ„ κ²€μƒ‰
List<OrderSummary> results = orderSummaryDao.findAll(spec);
```

---
## 5.5 μ¤ν™ μ΅°ν•©

μ¤ν”„λ§ λ°μ΄ν„° JPAκ°€ μ κ³µν•λ” `μ¤ν™ μΈν„°νμ΄μ¤`λ” `μ¤ν™μ„ μ΅°ν•©ν•  μ μλ” λ‘ λ©”μ„λ“λ¥Ό μ κ³µ`ν•κ³  μμµλ‹λ‹¤.

1. `and()`: **λ‘ μ¤ν™μ„ λ¨λ‘ μ¶©μ΅±ν•λ” μ΅°κ±΄μ„ ν‘ν„**ν•λ” μ¤ν™μ„ μƒμ„±
2. `or()`: **λ‘ μ¤ν™ μ¤‘ ν•λ‚ μ΄μƒ μ¶©μ΅±ν•λ” μ΅°κ±΄μ„ ν‘ν„**ν•λ” μ¤ν™μ„ μƒμ„±

λ‘ λ©”μ„λ“ λ‹¤ κΈ°λ³Έ κµ¬ν„μ„ κ°€μ§„ `default λ©”μ„λ“`μ…λ‹λ‹¤.

```java
public interface Specification<T> extends Serializable {
  // ...
  default Specification<T> and(@Nullable Specification<T> other) { ... }
  default Specification<T> or(@Nullable Specification<T> other) { ... }
  
  // toPredicate() μƒλµ
}
```

μ¤ν™μ„ μ΅°ν•©ν•λ” μ½”λ“ μμ λ” μ•„λμ™€ κ°™μµλ‹λ‹¤.
```java
Specification<OrderSummary> spec1 = OrderSummarySpecs.ordererId("user1");
Specification<OrderSummary> spec2 = OrderSummarySpecs.orderDateBetween(
    LocalDateTime.of(2022, 1, 1, 0, 0, 0),
    LocalDateTime.of(2022, 1, 2, 0, 0, 0));

Specification<OrderSummary> spec3 = spec1.and(spec2); // spec1κ³Ό spec2λ¥Ό λ¨λ‘ μ¶©μ΅±ν•λ” spec3 μƒμ„±

// μ•„λμ²λΌ λ¶ν•„μ”ν• λ³€μ μ‚¬μ©μ„ μ¤„μ—¬λ„ λλ‹¤.
Specification<OrderSummary> spec3 = OrderSummarySpecs.ordererId("user1")
    .and(OrderSummarySpecs.orderDateBetween(from, to));
```

μ¤ν™ μΈν„°νμ΄μ¤λ” λν• `not()` λ©”μ„λ“λ„ μ κ³µν•©λ‹λ‹¤. `not()`μ€ μ •μ  λ©”μ„λ“λ΅ μ΅°κ±΄μ„ λ°λ€λ΅ μ μ©ν•  λ• μ‚¬μ©ν•©λ‹λ‹¤.
```java
// μ •μ  λ©”μ„λ“ not()
Specification<OrderSummary> spec =
    Specification.not(OrderSummarySpecs.ordereId("userId"));
```

λν•, `null` κ°€λ¥μ„±μ΄ μλ” μ¤ν™ κ°μ²΄μ™€ λ‹¤λ¥Έ μ¤ν™μ„ μ΅°ν•©ν•΄μ•Ό ν•  λ•κ°€ μλ”λ°, μ΄ κ²½μ° `where()` λ©”μ„λ“λ¥Ό μ‚¬μ©ν•λ©΄ νΈλ¦¬ν•©λ‹λ‹¤.
```java
Specification<OrderSummary> nullableSpec = createNullableSpec(); // null μΌ μ μμ
Specification<OrderSummary> otherSpec = createOtherSpec();

// λ§¤λ² μ•„λμ²λΌ κ²€μ‚¬ν•λ ¤λ©΄ κ·€μ°®λ‹¤.
Specification<OrderSummary> spec = nullableSpec == null ? otherSpec : nullableSpec.and(otherSpec);

// μ •μ  λ©”μ„λ“ where()
Specification<OrderSummary> spec =
    Specification.where(createNullableSpec()).and(createOtherSpec());
```

`where()` λ©”μ„λ“λ” μ •μ  λ©”μ„λ“μΈλ°, νλΌλ―Έν„°λ΅ nullμ„ μ „λ‹¬ν•λ©΄ `μ•„λ¬΄ μ΅°κ±΄λ„ μƒμ„±ν•μ§€ μ•λ” μ¤ν™ κ°μ²΄λ¥Ό λ¦¬ν„΄`ν•κ³  nullμ΄ μ•„λ‹λ©΄, μΈμλ΅ λ°›μ€ μ¤ν™ κ°μ²΄λ¥Ό κ·Έλ€λ΅ λ¦¬ν„΄ν•©λ‹λ‹¤.

> π¥Έ λ©”μ„λ“ μ •λ¦¬
> 1. `and()`: **λ‘ μ¤ν™μ„ λ¨λ‘ μ¶©μ΅±ν•λ” μ΅°κ±΄μ„ ν‘ν„**ν•λ” μ¤ν™μ„ μƒμ„±
> 2. `or()`: **λ‘ μ¤ν™ μ¤‘ ν•λ‚ μ΄μƒ μ¶©μ΅±ν•λ” μ΅°κ±΄μ„ ν‘ν„**ν•λ” μ¤ν™μ„ μƒμ„±
> 3. `not()`: μ •μ  λ©”μ„λ“λ΅ **μ΅°κ±΄μ„ λ°λ€λ΅ μ μ©ν•  λ• μ‚¬μ©**
> 4. `where()`: νλΌλ―Έν„°λ΅ nullμ„ μ „λ‹¬ν•λ©΄ `μ•„λ¬΄ μ΅°κ±΄λ„ μƒμ„±ν•μ§€ μ•λ” μ¤ν™ κ°μ²΄λ¥Ό λ¦¬ν„΄`ν•κ³  nullμ΄ μ•„λ‹λ©΄, μΈμλ΅ λ°›μ€ μ¤ν™ κ°μ²΄λ¥Ό κ·Έλ€λ΅ λ¦¬ν„΄(nullableν• μ¤ν™μ„ μ΅°ν•©ν•  λ• μ μ©ν•λ‹¤.)

![andor.png](image%2Fandor.png)
![not.png](image%2Fnot.png)
![where.png](image%2Fwhere.png)

> `where()` λ©”μ„λ“λ¥Ό λ³΄μ‹λ©΄ `@Deprecated` μ–΄λ…Έν…μ΄μ…μ΄ λ¶™μ€ κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤. `Spring Data`μ 4.0 λ²„μ „λ¶€ν„° μ‚¬λΌμ§ μμ •μ΄λΌκ³  ν•©λ‹λ‹¤.