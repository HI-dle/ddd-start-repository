# 10.4 동기 이벤트 문제

이벤트를 동기로 처리할 때 다음 문제가 발생

예제코드
```java
//1. 응용 서비스 코드
@Transactional
public void cancel(OrderNo orderNo){
    Order order = findOrder(OrderNo);
    order.cancel();//order.cancel()에서 OrderCanceledEvent발생
}
//2. 이벤트를 처리하는 코드
@Service
public class OrderCancelEventHandler{
    @EventListener(OrderCanceledEvent.class){
        public void handler(OrderCanceledEvent event){
            //refundService.refund()가 느려지거나 익셉션이 발생하면?
            refundService.refund(event.getOrderNumber());
        }
    }
}
```

성능 문제

- refundService.refund()가 외부 환불 시스템과 연동됨

- 외부 서비스가 느려지면 cancel() 메서드도 함께 지연됨

- 결과: 외부 서비스 지연이 내 시스템 성능 저하로 이어짐

트랜잭션 문제 
- refundService.refund()에서 예외 발생 시 cancel() 트랜잭션이 롤백

   >여기서 롤백은 구매 취소기능을 롤백하는것으로 구매취소가 실패되는 것과 같다

- 구매취소 자체는 처리하고 환불만 재처리하거나 수동으로 처리할수 있다

외부시스템과 연동을 동기로 처리할 때 발생하는 성능과 트랜잭션 범위문제를 해소하는 방법은 **이벤트를 비동기로 처리**하거나 **이벤트와 트랜잭션을 연계**하는것이다 

